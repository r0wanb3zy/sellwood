<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Search and Populate Form</title>
<style>
    /* Modern CSS styles */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    
    #container {
      width: 250px;
      max-width: 600px;
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
      margin: 20px auto; /* Center horizontally with top margin */
    }
    
    #searchInput {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #d72c20;
      border-radius: 5px;
      margin-bottom: 5px;
      box-sizing: border-box;
      outline: none;
      text-align: center;
      font-family: Arial, sans-serif; /* Set font family */
    }
    
    #searchInput::placeholder {
      color: #d72c20;
      font-size: 16px; /* Set font size for placeholder */
    }
    
    .dropdown {
      position: relative;
    }
    
    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      width: 250px; /* Set width to 250px */
      max-height: 300px; /* Adjust the maximum height as needed */
      overflow-y: auto; /* Enable vertical scrolling */
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
    }
    
    .dropdown-content a {
      padding: 12px 16px;
      display: block;
    }
    
    .dropdown-content a:hover {
      background-color: #f1f1f1;
    }
    
    #infoForm label {
      display: none; /* Hide labels */
    }
    
    #infoForm input[type="text"],
    #infoForm textarea,
    #infoForm select {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-bottom: 5px; /* Adjusted margin to 5px */
      box-sizing: border-box;
      resize: vertical;
      text-align: center;
      font-family: Arial, sans-serif; /* Set font family */
    }

    #infoForm input[type="text"]::placeholder,
    #infoForm textarea::placeholder,
    #infoForm select::placeholder {
      color: #ccc; /* Light grey placeholder */
      font-size: 16px; /* Set font size for placeholder */
    }
    
    #infoForm #address {
      margin-bottom: 1px; /* Adjusted margin for address field */
    }
    
    #infoForm button {
      width: 100%;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #d72c20;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    
    #infoForm button:hover {
      background-color: #9a1f16;
    }
    
    #infoForm select {
      background-color: #fff;
      color: #333;
      background-image: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      padding-right: 10px;
    }

    #infoForm select option {
      background-color: #fff;
      color: #333;
    }
</style>
</head>
<body>

  <div id="container">
    <input type="text" id="searchInput" placeholder="Search" tabindex="1">
    <div id="searchResults" class="dropdown"></div>

    <form id="infoForm">
      <input type="text" id="name" placeholder="Name">
      <textarea id="address" placeholder="Street&#10;Suburb&#10;City" rows="3"></textarea>
      <input type="text" id="phone" placeholder="Phone">
      <input type="text" id="notes" placeholder="Notes">
      <!-- Add dropdown menu -->
      <select id="items">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
      <!-- Add print button -->
      <button type="button" onclick="printContent()">Print</button>
    </form>
  </div>

  <script>
    // Your existing JavaScript code here
    // Assuming data.csv has columns: Name, Street, Suburb, City, Phone, Notes
    const csvFilePath = 'https://raw.githubusercontent.com/SellwoodPro/sellwood/main/building-supply-merchants.csv';

    // Fetch data from CSV file
    fetch(csvFilePath)
      .then(response => response.text())
      .then(data => {
        const rows = data.split('\n').slice(1); // Skip header row
        const dataArray = rows.map(row => row.split(','));

        // Your search logic here
        const searchInput = document.getElementById('searchInput');
        const searchResultsContainer = document.getElementById('searchResults');

        searchInput.addEventListener('input', function () {
          const searchTerm = this.value.toLowerCase();
          const searchResults = dataArray.filter(row =>
            row.some(col => col.toLowerCase().includes(searchTerm))
          );

          searchResultsContainer.innerHTML = '';

          const dropdownContent = document.createElement('div');
          dropdownContent.classList.add('dropdown-content');

          searchResults.forEach((result, index) => {
            const listItem = document.createElement('a');
            listItem.textContent = result[0]; // Assuming the first column is the Name
            listItem.tabIndex = index + 2; // Set tabindex for tab navigation
            listItem.setAttribute('role', 'option'); // Set ARIA role

            listItem.addEventListener('click', function () {
              // Populate the form fields
              populateForm(result);
              dropdownContent.style.display = 'none'; // Hide dropdown after selection
            });

            listItem.addEventListener('keydown', function (event) {
              if (event.key === 'Enter') {
                // Populate the form fields
                populateForm(result);
                dropdownContent.style.display = 'none'; // Hide dropdown after selection
              } else if (event.key === 'Tab') {
                event.preventDefault();
                const nextIndex = (index + 1) % searchResults.length;
                searchResultsContainer.querySelectorAll('a')[nextIndex].focus();
              } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                const prevIndex = (index - 1 + searchResults.length) % searchResults.length;
                searchResultsContainer.querySelectorAll('a')[prevIndex].focus();
              } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                const nextIndex = (index + 1) % searchResults.length;
                searchResultsContainer.querySelectorAll('a')[nextIndex].focus();
              }
            });

            dropdownContent.appendChild(listItem);
          });

          searchResultsContainer.appendChild(dropdownContent);
          dropdownContent.style.display = 'block';
        });
      });

    // Function to collapse menu when clicking outside
    document.body.addEventListener('click', function(event) {
      const searchInput = document.getElementById('searchInput');
      const searchResults = document.getElementById('searchResults');
      if (event.target !== searchInput && event.target !== searchResults) {
        const dropdownContent = document.querySelector('.dropdown-content');
        if (dropdownContent) {
          dropdownContent.style.display = 'none';
        }
      }
    });

    function populateForm(result) {
      document.getElementById('name').value = result[0];
      const street = result[1] || '';
      const suburb = result[2] || '';
      const city = result[3] || '';
      const addressValue = suburb ? `${street}\n${suburb}\n${city}` : `${street}\n${city}`;
      document.getElementById('address').value = addressValue;
      document.getElementById('phone').value = result[4] || '';
      document.getElementById('notes').value = result[5] || '';
    }

    function printContent() {
      var nameContent = document.getElementById("name").value.toUpperCase();
      var addressContent = document.getElementById("address").value.toUpperCase();
      var phoneContent = formatPhoneNumber(document.getElementById("phone").value.toUpperCase().replace(/[ -]/g, ''));
      var notesContent = document.getElementById("notes").value; // Do not change the case
      var itemsValue = parseInt(document.getElementById("items").value);

      var printWindow = window.open('', '_blank');
      printWindow.document.write('<html><head><title>Printable Content</title><style>');
      printWindow.document.write('body { font-family: "Arial Narrow", "Arial", sans-serif; margin: 0; padding: 0; }');
      printWindow.document.write('@media print { body { font-family: "Arial Narrow", "Arial", sans-serif; } }');
      printWindow.document.write('.content-container { display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; font-size: 28px; margin: 0 auto; max-width: 600px; height: 100vh; }');
      printWindow.document.write('.content-container p { margin: 0; }');
      printWindow.document.write('.content-container .category { margin: 5px 0; }'); // Reduced space between fields to 5px
      printWindow.document.write('.notes { font-size: 12pt; }');
      printWindow.document.write('.contact { font-size: 20px; }');
      printWindow.document.write('.label { page-break-after: always; }'); // Ensure page breaks between labels
      printWindow.document.write('.line { border-top: 1px solid black; width: 90%; margin: 0 auto; }'); // Define the line style
      printWindow.document.write('</style></head><body>');

      for (let i = 1; i <= itemsValue; i++) {
        printWindow.document.write('<div class="content-container label">');
        printWindow.document.write('<p class="category"><strong>' + nameContent + '</strong></p>');
        printWindow.document.write('<div class="line"></div>'); // Add the line between name and address
        printWindow.document.write('<div class="category"><strong>' + addressContent.replace(/\n/g, '<br>') + '</strong></div>');
        printWindow.document.write('<div class="line"></div>');
        printWindow.document.write('<p class="category contact">' + phoneContent + '</p>');
        printWindow.document.write('<p class="category notes"><em>' + notesContent + '</em></p>');
        if (itemsValue > 1) {
          printWindow.document.write('<p class="category" style="font-size: 12pt; font-style: italic;"><strong>' + i + ' of ' + itemsValue + '</strong></p>');
        }
        printWindow.document.write('</div>');
      }

      printWindow.document.write('</body></html>');
      printWindow.document.close();

      printWindow.onload = function () {
        printWindow.print();
      };
    }


    function formatPhoneNumber(phoneNumber) {
      phoneNumber = phoneNumber.replace(/^\+64/, '0');

      var mobilePattern = /^(021|022|027|029)(\d{3}|\d{4})(\d{4}|\d{3})$/;
      var landlinePattern = /^(?!08)(0[3-9])(\d{3}|\d{4})(\d{4}|\d{3})$/;
      var tollFreePattern = /^(0800)(\d{3}|\d{4})(\d{4}|\d{3})$/;

      if (mobilePattern.test(phoneNumber)) {
        return phoneNumber.replace(/^(021|022|027|029)(\d{3}|\d{4})(\d{4}|\d{3})$/, '$1 $2 $3');
      } else if (landlinePattern.test(phoneNumber)) {
        return phoneNumber.replace(/^(?!08)(0[3-9])(\d{3}|\d{4})(\d{4}|\d{3})$/, '$1 $2 $3');
      } else if (tollFreePattern.test(phoneNumber)) {
        return phoneNumber.replace(/^(0800)(\d{3}|\d{4})(\d{4}|\d{3})$/, '$1 $2 $3');
      } else {
        return phoneNumber;
      }
    }
  </script>
</body>
</html>
